<html>

<head>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css">
    <link rel="stylesheet" href="https://unpkg.com/materialize-stepper@3.1.0/dist/css/mstepper.min.css">
    <script src="https://code.getmdl.io/1.1.3/material.min.js"></script>
    <script src="https://unpkg.com/materialize-stepper@3.1.0/dist/js/mstepper.min.js"></script>
    <!-- Stepper CSS minified -->
    <link rel="stylesheet" href="./stepper.min.css">
    <!-- Stepper Javascript minified -->


    <title>Sono vittima?</title>
</head>

<body>
    <script type="text/javascript" src="./stepper.min.js"></script>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header
    mdl-layout--fixed-tabs">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <!-- Title -->
                <span class="mdl-layout-title">Sei vittima di data breach?</span>
            </div>
        </header>


        <ul class="mdl-stepper mdl-stepper--linear mdl-stepper--vertical" id="demo-stepper-nonlinear">
            <li class="mdl-step">
                <span class="mdl-step__label">
              <span class="mdl-step__title">
                <span class="mdl-step__title-text">E-mail</span>
                </span>
                </span>
                <div class="mdl-step__content">
                    CIOOOO
                    <p>Benvenut* a questa indagine sui data breach, se parteciperai potrai scoprire se sei stat* vittima di esfiltrazione di dati personali.</p>
                    <p>Ti vogliamo assicurare che la tua e-mail non verrà memorizzata da nessuna parte e che i tuoi dati verranno trattati in modo completamente anonimo</p>
                    <p> Per favore, inserisci qui il tuo indirizzo e-mail</p>
                    <div class="mdl-textfield mdl-js-textfield">
                        <input class="mdl-textfield__input" type="text" id="email" name="email"><br><br>
                        <label class="mdl-textfield__label" for="email">Indirizzo e-mail...</label>
                    </div>
                </div>
                <div class="mdl-step__actions">
                    <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored mdl-button--raised" onclick="myAPI()" data-stepper-next>
            Continua
          </button>
                    <button class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-cancel>
            Cancel
          </button>
                    <button class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-back disabled>
            Back
          </button>
                </div>
            </li>

            <li class="mdl-step">
                <span class="mdl-step__label">
          <span class="mdl-step__title">
            <span class="mdl-step__title-text">Risultato</span>
                </span>
                </span>
                <div class="mdl-step__content">
                    <div id="risultato"></div>
                    <div id="lista"></div>
                </div>
                <div class="mdl-step__actions">
                    <button id="bottone2" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored mdl-button--raised" data-stepper-next>
            Continue
          </button>
                    <button class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-back>
            Back
          </button>
                </div>
            </li>

            <li class="mdl-step">
                <span class="mdl-step__label">
          <span class="mdl-step__title">
            <span class="mdl-step__title-text">Sondaggio</span>
                </span>
                </span>
                <div class="mdl-step__content">
                    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdpKfmASI77RfLYmZoDBOXBVYXWsIDFGVQyP0W84Ix0vNmaNQ/viewform?embedded=true" width="640" height="675" frameborder="0" marginheight="0" marginwidth="0">Caricamento…</iframe>
                </div>
                <div class="mdl-step__actions">
                    <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored mdl-button--raised" data-stepper-next disabled>
            Continue
          </button>
                    <button class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-cancel>
            Cancel
          </button>
                    <button class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-back>
            Back
          </button>
                </div>
            </li>
        </ul>



        <script>
            componentHandler.upgradeAllRegistered();

            function stepback() {
                var selector = '.mdl-stepper#demo-stepper-nonlinear';
                // Select stepper container element      
                var stepperElement = document.querySelector(selector);
                var Stepper;
                Stepper = stepperElement.MaterialStepper;
                Stepper.next();
            }
            (function() {
                var selector = '.mdl-stepper#demo-stepper-nonlinear';
                // Select stepper container element      
                var stepperElement = document.querySelector(selector);
                var Stepper;
                var steps;

                if (!stepperElement) return;

                // Get the MaterialStepper instance of element to control it.          
                Stepper = stepperElement.MaterialStepper;

                if (!Stepper) {
                    console.error('MaterialStepper instance is not available for selector: ' + selector + '.');
                    return;
                }
                steps = stepperElement.querySelectorAll('.mdl-step');

                for (var i = 0; i < steps.length; i++) {
                    // When user clicks on [data-stepper-next] button of step.          
                    steps[i].addEventListener('onstepnext', function(e) {
                        // {element}.MaterialStepper.next() change the state of current step to "completed" 
                        // and move one step forward.        
                        Stepper.next();
                    });
                    // When user clicks on [data-stepper-back] button of step.          
                    steps[i].addEventListener('onstepback', function(e) {
                        console.log("stepback")
                        Stepper.back();
                    });
                }

                // When all steps are completed this event is dispatched.          
                stepperElement.addEventListener('onsteppercomplete', function(e) {
                    var toast = document.querySelector('#snackbar-stepper-complete');

                    if (!toast) return;

                    toast.MaterialSnackbar.showSnackbar({
                        message: 'Stepper non-linear are completed',
                        timeout: 4000,
                        actionText: 'Ok'
                    });
                });
            })();
        </script>

        <script type="text/javascript">
            function myAPI() {
                email = document.getElementById("email").value;

                console.log('la mail selezionata e' + email)


                fetch('./hibp?email=' + email)
                    .then(response => response.json())
                    .then(data => printBreach(data))
                    .catch(e => console.log(e));


            }

            function printBreach(data) {
                console.log(data.ok);
                if (data.ok == "ok") {
                    divRisultato = document.getElementById("risultato");
                    h3Risultato = document.createElement('h3');
                    pRisultato = document.createElement('p');
                    pRisultato.innerHTML = "Il tuo indirizzo e-mail non risulta in nessuno dei data breach a nostra conoscenza. Puoi provare con un" +
                        " altro indirizzo o abbandonare il sito. Grazie!";
                    h3Risultato.innerHTML = "Buone notizie!";
                    divRisultato.appendChild(h3Risultato);
                    divRisultato.appendChild(pRisultato);
                    console.log("APPESO");
                } else {
                    divRisultato = document.getElementById("risultato");
                    h3Risultato = document.createElement('h3');
                    pRisultato = document.createElement('p');
                    pRisultato.innerHTML = "Il tuo indirizzo e-mail è stato trovato in " + data.length + " data breach. Di seguito la lista.";
                    h3Risultato.innerHTML = "Pessime notizie!";
                    divRisultato.appendChild(h3Risultato);
                    divRisultato.appendChild(pRisultato);
                    lista = document.getElementById("lista");
                    console.log(data);
                    for (i in data) {
                        breach = data[i];
                        elemento = document.createElement('li');
                        elemento.className = "mdl-list__item";
                        span = document.createElement('span');
                        span.className = "mdl-list__item-primary-content"
                        elemento.appendChild(span);
                        lista.appendChild(elemento);
                        elemento.innerHTML = elemento.innerHTML + breach.Name;
                    }
                }
            }
        </script>
    </div>
</body>

</html>