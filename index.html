<html>

<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />

    <script src="https://unpkg.com/materialize-stepper@3.1.0/dist/js/mstepper.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/materialize-stepper@3.1.0/dist/css/mstepper.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.getmdl.io/1.1.3/material.min.js"></script>

    <style>
        blockquote {
            border-left: 5px solid #2196f3;
        }
        
        .btn,
        .btn-large,
        .btn-small,
        .btn-flat {
            border-radius: 4px;
            font-weight: 500;
        }
        
        .card:hover {
            box-shadow: 0px 10px 35px 0px rgba(0, 0, 0, 0.18);
        }
        
        .card {
            border-radius: 15px;
            box-shadow: 0px 5px 25px 0px rgba(0, 0, 0, 0.15);
        }
    </style>


    <title>Sono vittima?</title>
</head>

<body>
    <script type="text/javascript" src="./stepper.min.js"></script>
    <div class="section grey lighten-5">
        <div class="container">
            <div class="row">


                <h3 class="light center-align blue-text">Dove sono i miei dati?</h3>
                <div class="card">
                    <div class="card-content">


                        <ul class="stepper horizontal linear">

                            <li class="step active">
                                <div class="step-title waves-effect waves-dark">Introduzione</div>
                                <div class="step-content">
                                    <div class="row">
                                        <blockquote>
                                            Benvenut*! Sto conducendo un'indagine sulle reazioni delle persone quando vengono a conoscenza di essere state <b>vittime di data breach</b>. Un data breach è una violazione di sicurezza che comporta - accidentalmente
                                            o in modo illecito - la distruzione, la perdita, la modifica, la divulgazione non autorizzata o l’accesso ai dati personali trasmessi, conservati o comunque trattati.
                                        </blockquote>
                                        <blockquote>
                                            Nei prossimi passaggi potrai scoprire se sei mai stat* vittima di un data breach e potrai sapere quali e quanti. Alla fine ti chiederò di compilare un piccolo questionario che mi sarà molto utile.
                                        </blockquote>
                                        <blockquote>
                                            D'accordo? Fai tap o clicca su Avanti!
                                        </blockquote>

                                        <blockquote>
                                            Ci tengo a ricordarti che <b>in nessun modo</b> alcuno dei tuoi dati che fornirai verrà salvato. Il sondaggio finale è <b>anonimo</b>.
                                        </blockquote>
                                    </div>
                                    <div class="step-actions">
                                        <button class="waves-effect waves-dark btn blue next-step" data-feedback="anyThing">Avanti</button>
                                    </div>
                                </div>
                            </li>
                            <li class="step">
                                <div class="step-title waves-effect waves-dark">La tua e-mail</div>
                                <div class="step-content">
                                    <div class="row">
                                        <blockquote>Inserisci qui il tuo indirizzo e-mail che usi più di frequente (ad esempio per registrarti ad un sito). Ancora una volta ti ricordiamo che <b>non verrà conservato</b> da nessuna parte, nel rispetto della tua privacy.
                                        </blockquote>
                                        <div class="input-field col s12">
                                            <input id="email" name="email" type="email" class="validate" required>
                                            <label for="email">La tua e-mail</label>
                                        </div>
                                    </div>
                                    <div class="step-actions">
                                        <button class="waves-effect waves-dark btn blue next-step" onclick="myAPI()" data-feedback="anyThing">Avanti</button>
                                        <button class="waves-effect waves-dark btn-flat previous-step">Indietro</button>
                                    </div>
                                </div>
                            </li>

                            <li class="step">
                                <div class="step-title waves-effect waves-dark">Risultato</div>

                                <div class="step-content">

                                    <div class="row">

                                        <div id="risultato"></div>
                                        <div id="divLista"></div>
                                    </div>

                                    <div class="step-actions" style="position: static">
                                        <button id="continuaAlSondaggio" class="waves-effect waves-dark btn blue next-step">Avanti</button>
                                        <button class="waves-effect waves-dark btn-flat previous-step">Indietro</button>

                                    </div>


                                </div>
                            </li>

                            <li class="step">
                                <div class="step-title waves-effect waves-dark">Sondaggio</div>
                                <div class="step-content">
                                    <blockquote>Ti chiediamo per favore di compilare questo sondaggio. Se vuoi, puoi compilarlo anche a <a href="https://docs.google.com/forms/d/e/1FAIpQLSdpKfmASI77RfLYmZoDBOXBVYXWsIDFGVQyP0W84Ix0vNmaNQ">questo link</a>. Grazie!</blockquote>
                                    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdpKfmASI77RfLYmZoDBOXBVYXWsIDFGVQyP0W84Ix0vNmaNQ/viewform?embedded=true" width=100% height="675" frameborder="0" marginheight="0" marginwidth="0">Caricamento…</iframe>
                                </div>
                                <div class="step-actions">
                                    <button class="waves-effect waves-dark btn-flat previous-step">Indietro</button>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        if (!(typeof(componentHandler) == 'undefined')) {
            componentHandler.upgradeAllRegistered();
        }

        function anyThing(destroyFeedback) {
            setTimeout(function() {
                destroyFeedback(true);
            }, 1500);
        }

        function noThing(destroyFeedback) {
            setTimeout(function() {
                destroyFeedback(true);
            }, 10000);
        }

        var stepperDiv = document.querySelector('.stepper');
        console.log(stepperDiv);
        var stepper = new MStepper(stepperDiv);
    </script>


    <script type="text/javascript">
        function myAPI() {
            pulisciStep2();
            email = document.getElementById("email").value;

            console.log('la mail selezionata e' + email)


            fetch('./hibp?email=' + email)
                .then(response => response.json())
                .then(data => printBreach(data))
                .catch(e => console.log(e));


        }

        function pulisciStep2() {
            divRisultato = document.getElementById("risultato");
            divRisultato.innerHTML = "";

            divLista = document.getElementById("divLista");
            divLista.innerHTML = "";

            bottoneAlSondaggio = document.getElementById("continuaAlSondaggio");
            bottoneAlSondaggio.disabled = false;
        }



        function printBreach(data) {
            console.log(data.ok);
            if (data.ok == "ok") {
                divRisultato = document.getElementById("risultato");
                h2Risultato = document.createElement('h2');
                blockquoteRisultato = document.createElement('blockquote');
                blockquoteRisultato.innerHTML = "Il tuo indirizzo e-mail non risulta in nessuno dei data breach a nostra conoscenza. Puoi provare con un" +
                    " altro indirizzo o abbandonare il sito. Grazie!";
                h2Risultato.innerHTML = "Buone notizie!";
                divRisultato.appendChild(h2Risultato);
                divRisultato.appendChild(blockquoteRisultato);
                bottoneAlSondaggio = document.getElementById("continuaAlSondaggio");
                bottoneAlSondaggio.disabled = "true";
            } else {
                divRisultato = document.getElementById("risultato");
                h2Risultato = document.createElement('h2');
                blockquoteRisultato = document.createElement('blockquote');
                blockquoteRisultato.innerHTML = "Il tuo indirizzo e-mail è stato trovato in " + data.length + " data breach. Di seguito la lista.";
                h2Risultato.innerHTML = "Pessime notizie!";
                divRisultato.appendChild(h2Risultato);
                divRisultato.appendChild(blockquoteRisultato);
                divLista = document.getElementById("divLista");
                lista = document.createElement('ul');
                lista.className = "collection";
                divLista.appendChild(lista);
                console.log(data);
                for (i in data) {
                    breach = data[i];
                    elemento = document.createElement('li');
                    elemento.className = "collection-item";
                    lista.appendChild(elemento);
                    elemento.innerHTML = elemento.innerHTML + breach.Name;
                }
            }
        }
    </script>
    <script type="text/javascript" src="js/materialize.min.js"></script>
</body>

</html>