<html>

<head>
 <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css">
<script src="https://code.getmdl.io/1.1.3/material.min.js"></script>
<!-- Stepper CSS minified -->
<link rel="stylesheet"  href="./stepper.min.css">
<!-- Stepper Javascript minified -->

  
    <title>Sono vittima?</title>
</head>

<body>
  <script type="text/javascript" src="./stepper.min.js"></script>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header
    mdl-layout--fixed-tabs">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <!-- Title -->
                <span class="mdl-layout-title">Title</span>
            </div>
    </header>
          
          
<ul class="mdl-stepper mdl-stepper--linear mdl-stepper--horizontal" id="demo-stepper-linear">
  <li class="mdl-step">
    <span class="mdl-step__label">
              <span class="mdl-step__title">
                <span class="mdl-step__title-text">E-mail</span>
    </span>
       </span>
    <div class="mdl-step__content">
      CIOOOO
      <p>Benvenut* a questa indagine sui data breach, se parteciperai potrai scoprire se sei stat* vittima
                        di esfiltrazione di dati personali.</p>
                    <p>Ti vogliamo assicurare che la tua e-mail non verrà memorizzata da nessuna parte e che i tuoi dati
                        verranno trattati in modo completamente anonimo</p>
                    <p> Per favore, inserisci qui il tuo indirizzo e-mail</p>
                    <div class="mdl-textfield mdl-js-textfield">
                        <input class="mdl-textfield__input" type="text" id="email" name="email"><br><br>
                        <label class="mdl-textfield__label" for="email">Indirizzo e-mail...</label>
                    </div>
    </div>
    <div class="mdl-step__actions">
      <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored mdl-button--raised" onclick="myAPI()" data-stepper-next>
            Continua
          </button>
      <button class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-cancel>
            Cancel
          </button>
    </div>
  </li>
  
  <li class="mdl-step">
    <span class="mdl-step__label">
          <span class="mdl-step__title">
            <span class="mdl-step__title-text">Risultato</span>
    </span>
    </span>
    <div class="mdl-step__content">
      <div id="risultato"></div>
      <div id="lista"></div>
    </div>
    <div class="mdl-step__actions">
      <button id="bottone2" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored mdl-button--raised" data-stepper-next>
            Continue
          </button>
      <button id="cancella2" onclick="location.reload()" class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-cancel>
            Indietro
          </button>
    </div>
  </li>
  
  <li class="mdl-step">
    <span class="mdl-step__label">
          <span class="mdl-step__title">
            <span class="mdl-step__title-text">Sondaggio</span>
    </span>
    </span>
    <div class="mdl-step__content">
      <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdpKfmASI77RfLYmZoDBOXBVYXWsIDFGVQyP0W84Ix0vNmaNQ/viewform?embedded=true" 
      width="640" height="675" frameborder="0" marginheight="0" marginwidth="0">Caricamento…</iframe>
    </div>
    <div class="mdl-step__actions">
      <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored mdl-button--raised" data-stepper-next>
            Continue
          </button>
      <button class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-cancel>
            Cancel
          </button>
    </div>
  </li>
</ul>
  
  
  
  <script>
    componentHandler.upgradeAllRegistered();
  (function () {
    var selector = '.mdl-stepper#demo-stepper-linear';
    // Select stepper container element      
    var stepperElement = document.querySelector(selector);
    var Stepper;
    var steps;
    
    if (!stepperElement) return;
    
    // Get the MaterialStepper instance of element to control it.          
    Stepper = stepperElement.MaterialStepper;
    
    if (!Stepper) {
      console.error('MaterialStepper instance is not available for selector: ' + selector + '.');
      return;
    }
    steps = stepperElement.querySelectorAll('.mdl-step');

    for (var i = 0; i < steps.length; i++) {
      // When user clicks on [data-stepper-next] button of step.          
      steps[i].addEventListener('onstepnext', function (e) {
        // {element}.MaterialStepper.next() change the state of current step to "completed" 
        // and move one step forward.        
        Stepper.next();              
      });
    }

    // When all steps are completed this event is dispatched.          
    stepperElement.addEventListener('onsteppercomplete', function (e) {
      var toast = document.querySelector('#snackbar-stepper-complete');

      if (!toast) return;

      toast.MaterialSnackbar.showSnackbar({
        message: 'Stepper linear are completed',
        timeout: 4000,
        actionText: 'Ok'
      });
    });
  })();

  /*(function () {
    var toggle = document.querySelector('[href="#stepper-linear-toggle"]');
    var snippetDirections = document.querySelector('#snippet-stepper-linear');
    var stepperElement = snippetDirections.querySelector('.mdl-stepper');
    var cssClassHorizontal = 'mdl-stepper--horizontal';

    toggle.addEventListener('click', function (event) {
      event.preventDefault();
      
      if (!stepperElement) return;

      if (stepperElement.classList.contains(cssClassHorizontal)) {
        stepperElement.classList.remove(cssClassHorizontal);
      } else {
        stepperElement.classList.add(cssClassHorizontal);        
      }
    });
  })();*/

</script>
  
<script type="text/javascript">
        function myAPI() {
            email = document.getElementById("email").value;

            console.log('la mail selezionata e' + email)


            fetch('./hibp?email=' + email)
                .then(response => response.json())
                .then(data => printBreach(data))
                .catch(e => console.log(e));


        }

        function printBreach(data) {
            console.log(data.ok);
            if (data.ok == "ok") {
                divRisultato = document.getElementById("risultato");
                h3Risultato = document.createElement('h3');
                pRisultato = document.createElement('p');
                pRisultato.innerHTML = "Il tuo indirizzo e-mail non risulta in nessuno dei data breach a nostra conoscenza. Puoi provare con un"+
                " altro indirizzo o abbandonare il sito. Grazie!";
                h3Risultato.innerHTML= "Buone notizie!";
                divRisultato.appendChild(h3Risultato);
                divRisultato.appendChild(pRisultato);
                console.log("APPESO");
                bottone2 = document.getElementById("bottone2");
                bottone2.style.display = "none";
            }
            else {
                divRisultato = document.getElementById("risultato");
                h3Risultato = document.createElement('h3');
                pRisultato = document.createElement('p');
                pRisultato.innerHTML = "Il tuo indirizzo e-mail è stato trovato in " + data.length + " data breach. Di seguito la lista.";
                h3Risultato.innerHTML= "Pessime notizie!";
                divRisultato.appendChild(h3Risultato);
                divRisultato.appendChild(pRisultato);
                lista = document.getElementById("lista");
                emptyList("lista");
                console.log(data);
                for (i in data) {
                    breach = data[i];
                    elemento = document.createElement('li');
                    elemento.className = "mdl-list__item";
                    span = document.createElement('span');
                    span.className = "mdl-list__item-primary-content"
                    elemento.appendChild(span);
                    lista.appendChild(elemento);
                    elemento.innerHTML = elemento.innerHTML + breach.Name;
                }
            }
        }

        function toggleDiv(id) {
            var div = document.getElementById(id);
            div.style.display = div.style.display == "none" ? "block" : "none";
        }

        function invisibile(id) {
            var div = document.getElementById(id);
            div.style.display = "none";

        }
        function visibile(id) {
            var div = document.getElementById(id);
            div.style.display = "block";

        }
        function emptyList(id) {
            root = document.getElementById(id);
            while (root.firstChild) {
                root.removeChild(root.firstChild);
            }
        }

        function inizio() {
            invisibile("vittima");
            invisibile("google_form");
            invisibile("ok");
            invisibile("container-lista");
        }
    </script>
    </div>
</body>

</html>